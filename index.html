<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peta Interaktif - Login</title>
    
    <!-- Memuat Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Memuat Leaflet CSS dan JS untuk fungsionalitas peta -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <style>
        /* Memastikan peta tidak terpotong dan memiliki bayangan yang bagus */
        #map {
            height: 600px;
            border-radius: 0.75rem; /* 12px */
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            z-index: 0;
        }
        /* Menggunakan font Inter yang modern */
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
     <link rel="preconnect" href="https://fonts.googleapis.com">
     <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
     <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 antialiased">

    <!-- Kontainer Halaman Login -->
    <div id="login-container" class="flex items-center justify-center min-h-screen">
        <div class="w-full max-w-md p-8 space-y-6 bg-white dark:bg-gray-800 rounded-lg shadow-md">
            <h1 class="text-3xl font-bold text-center text-gray-900 dark:text-white">Login</h1>
            <form id="login-form" class="space-y-6">
                <div>
                    <label for="username" class="text-sm font-medium text-gray-700 dark:text-gray-300">Username</label>
                    <input id="username" name="username" type="text" required class="w-full px-3 py-2 mt-1 text-gray-900 bg-gray-50 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                </div>
                <div>
                    <label for="password" class="text-sm font-medium text-gray-700 dark:text-gray-300">Password</label>
                    <input id="password" name="password" type="password" required class="w-full px-3 py-2 mt-1 text-gray-900 bg-gray-50 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                </div>
                <div>
                    <label for="role" class="text-sm font-medium text-gray-700 dark:text-gray-300">Role</label>
                    <select id="role" name="role" class="w-full px-3 py-2 mt-1 text-gray-900 bg-gray-50 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <p id="error-message" class="text-sm text-red-500 hidden">Username atau password salah!</p>
                <div>
                    <button type="submit" class="w-full px-4 py-2 font-semibold text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800">
                        Masuk
                    </button>
                </div>
            </form>
             <div class="text-center text-sm text-gray-500 dark:text-gray-400">
                <p>Admin: admin / admin123</p>
                <p>User: user / user123</p>
            </div>
        </div>
    </div>

    <!-- Kontainer Aplikasi Peta (disembunyikan secara default) -->
    <div id="map-app-container" class="container mx-auto p-4 sm:p-6 lg:p-8 hidden">
        <header class="flex justify-between items-center mb-6">
            <div>
                 <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white">Aplikasi Peta Interaktif</h1>
                 <p id="welcome-message" class="mt-2 text-lg text-gray-600 dark:text-gray-400"></p>
            </div>
            <button id="logout-button" class="px-4 py-2 font-semibold text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 dark:focus:ring-offset-gray-800">
                Keluar
            </button>
        </header>
       
        <!-- Kontainer untuk Peta -->
        <div id="map" class="w-full bg-white dark:bg-gray-800"></div>
    </div>

    <script>
        const loginContainer = document.getElementById('login-container');
        const mapAppContainer = document.getElementById('map-app-container');
        const loginForm = document.getElementById('login-form');
        const errorMessage = document.getElementById('error-message');
        const logoutButton = document.getElementById('logout-button');
        const welcomeMessage = document.getElementById('welcome-message');

        let map = null;

        // Fungsi untuk menginisialisasi peta
        function initializeMap() {
            // Mencegah inisialisasi ganda
            if (map !== null) {
                map.remove();
            }
            map = L.map('map').setView([-6.597146, 106.805412], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map);
            map.on('click', onMapClick);
        }

        // Fungsi yang akan dijalankan ketika peta diklik
        function onMapClick(e) {
            const lat = e.latlng.lat.toFixed(5);
            const lng = e.latlng.lng.toFixed(5);
            
            L.marker(e.latlng).addTo(map)
                .bindPopup(`<b>Koordinat Lokasi</b><br>Latitude: ${lat}<br>Longitude: ${lng}`)
                .openPopup();
        }

        // Event listener untuk form login
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const username = loginForm.username.value;
            const password = loginForm.password.value;
            const role = loginForm.role.value;

            // Kredensial sederhana (hardcoded)
            const isAdmin = role === 'admin' && username === 'admin' && password === 'admin123';
            const isUser = role === 'user' && username === 'user' && password === 'user123';

            if (isAdmin || isUser) {
                // Sembunyikan halaman login dan tampilkan peta
                loginContainer.classList.add('hidden');
                mapAppContainer.classList.remove('hidden');
                
                // Set pesan selamat datang
                const roleName = isAdmin ? 'Admin' : 'User';
                welcomeMessage.textContent = `Selamat Datang, ${roleName}! Klik di peta untuk menambahkan penanda.`;

                // Inisialisasi peta setelah login berhasil
                initializeMap();
                errorMessage.classList.add('hidden');
            } else {
                // Tampilkan pesan error jika login gagal
                errorMessage.classList.remove('hidden');
            }
        });

        // Event listener untuk tombol logout
        logoutButton.addEventListener('click', function() {
            // Sembunyikan peta dan tampilkan kembali halaman login
            mapAppContainer.classList.add('hidden');
            loginContainer.classList.remove('hidden');

            // Reset form
            loginForm.reset();
        });
    </script>

</body>
</html>
